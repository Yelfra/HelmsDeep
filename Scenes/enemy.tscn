[gd_scene load_steps=25 format=3 uid="uid://dudh0ki8j4bsx"]

[ext_resource type="Script" path="res://Scripts/Enemy.cs" id="1_q0kdg"]
[ext_resource type="Shader" path="res://Shaders/hurt_flash.gdshader" id="2_k22yu"]
[ext_resource type="Texture2D" uid="uid://cm74qco5e5rhl" path="res://Assets/UrukHai.png" id="2_m6dwn"]
[ext_resource type="PackedScene" uid="uid://bdbrg4adpvecf" path="res://Scenes/attack_manager.tscn" id="3_axqsw"]
[ext_resource type="PackedScene" uid="uid://b5p6dtecwmmqj" path="res://Scenes/StateMachine/state_machine.tscn" id="3_nbnit"]
[ext_resource type="PackedScene" uid="uid://dsdapvb5mxeug" path="res://Scenes/StateMachine/EnemyStates/enemy_pursue_state.tscn" id="4_0fxrs"]
[ext_resource type="PackedScene" uid="uid://b27piakcsvodx" path="res://Scenes/health_manager.tscn" id="4_8jpea"]
[ext_resource type="PackedScene" uid="uid://bexn8wt8aq2db" path="res://Scenes/StateMachine/EnemyStates/enemy_attack_state.tscn" id="5_b6vxn"]
[ext_resource type="PackedScene" uid="uid://dfro4mroyjn2g" path="res://Scenes/attack.tscn" id="6_eaq6t"]
[ext_resource type="PackedScene" uid="uid://d2bcorblx24e4" path="res://Scenes/StateMachine/hurt_state.tscn" id="7_pfd6a"]
[ext_resource type="PackedScene" uid="uid://bnlr5qt6tni5e" path="res://Scenes/StateMachine/EnemyStates/enemy_death_state.tscn" id="9_i6yqm"]
[ext_resource type="Texture2D" uid="uid://c8iwf7tkbfpyr" path="res://Assets/UrukHai_Head.png" id="10_mkacl"]

[sub_resource type="Animation" id="Animation_3o7dn"]
resource_name = "Attack"
length = 0.80001
tracks/0/type = "method"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("StateMachine/EnemyAttackState")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0.4, 0.6),
"transitions": PackedFloat32Array(1, 1),
"values": [{
"args": [],
"method": &"AttackStart"
}, {
"args": [],
"method": &"AttackEnd"
}]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("Sprite2D:frame_coords")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0, 0.1, 0.4, 0.5, 0.6, 0.7),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1),
"update": 1,
"values": [Vector2i(0, 2), Vector2i(1, 2), Vector2i(2, 2), Vector2i(3, 2), Vector2i(4, 2), Vector2i(5, 2)]
}

[sub_resource type="Animation" id="Animation_uvmaq"]
resource_name = "Death"
length = 3.0
tracks/0/type = "method"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("StateMachine/EnemyDeathState")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(3),
"transitions": PackedFloat32Array(1),
"values": [{
"args": [],
"method": &"Exit"
}]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("Sprite2D:frame_coords")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1, 1, 1),
"update": 1,
"values": [Vector2i(0, 3), Vector2i(1, 3), Vector2i(2, 3), Vector2i(3, 3), Vector2i(4, 3), Vector2i(5, 3), Vector2i(6, 3), Vector2i(7, 3)]
}

[sub_resource type="Animation" id="Animation_tkexa"]
resource_name = "Hurt"
length = 0.30001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:frame_coords")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [Vector2i(0, 0)]
}

[sub_resource type="Animation" id="Animation_86ju1"]
length = 0.001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:frame_coords")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [Vector2i(0, 2)]
}

[sub_resource type="Animation" id="Animation_v2jdc"]
resource_name = "Run"
length = 0.60001
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:frame_coords")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.1, 0.2, 0.3, 0.4, 0.5),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1),
"update": 1,
"values": [Vector2i(0, 1), Vector2i(1, 1), Vector2i(2, 1), Vector2i(3, 1), Vector2i(4, 1), Vector2i(5, 1)]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_u47h4"]
_data = {
"Attack": SubResource("Animation_3o7dn"),
"Death": SubResource("Animation_uvmaq"),
"Hurt": SubResource("Animation_tkexa"),
"RESET": SubResource("Animation_86ju1"),
"Run": SubResource("Animation_v2jdc")
}

[sub_resource type="ShaderMaterial" id="ShaderMaterial_aho1d"]
resource_local_to_scene = true
shader = ExtResource("2_k22yu")
shader_parameter/flash_intensity = 0.0

[sub_resource type="Animation" id="Animation_t6lst"]
resource_name = "HurtFlash"
length = 0.40001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:material:shader_parameter/flash_intensity")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.1, 0.2, 0.3),
"transitions": PackedFloat32Array(1, 1, 1, 1),
"update": 0,
"values": [1.0, 0.0, 1.0, 0.0]
}

[sub_resource type="Animation" id="Animation_ns2gn"]
length = 0.001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:material:shader_parameter/flash_intensity")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [0.0]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_8iprk"]
_data = {
"HurtFlash": SubResource("Animation_t6lst"),
"RESET": SubResource("Animation_ns2gn")
}

[sub_resource type="RectangleShape2D" id="RectangleShape2D_472yt"]
size = Vector2(12, 32)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_73crr"]
size = Vector2(17, 32)

[node name="Enemy" type="CharacterBody2D" node_paths=PackedStringArray("health", "attackManager")]
collision_layer = 4
script = ExtResource("1_q0kdg")
health = NodePath("HealthManager")
attackManager = NodePath("AttackManager")

[node name="AnimationPlayer" type="AnimationPlayer" parent="."]
libraries = {
"": SubResource("AnimationLibrary_u47h4")
}

[node name="Sprite2D" type="Sprite2D" parent="."]
texture_filter = 1
material = SubResource("ShaderMaterial_aho1d")
position = Vector2(0, -24)
texture = ExtResource("2_m6dwn")
hframes = 8
vframes = 4
frame = 16

[node name="EffectAnimationPlayer" type="AnimationPlayer" parent="."]
libraries = {
"": SubResource("AnimationLibrary_8iprk")
}

[node name="Hitbox" type="CollisionShape2D" parent="."]
position = Vector2(0, -16)
shape = SubResource("RectangleShape2D_472yt")

[node name="AttackBox" type="Area2D" parent="."]
collision_layer = 0
collision_mask = 2
monitoring = false
monitorable = false

[node name="CollisionShape2D" type="CollisionShape2D" parent="AttackBox"]
position = Vector2(17.5, -16)
shape = SubResource("RectangleShape2D_73crr")

[node name="HealthManager" parent="." node_paths=PackedStringArray("hurtState") instance=ExtResource("4_8jpea")]
hurtState = NodePath("../StateMachine/HurtState")

[node name="AttackManager" parent="." instance=ExtResource("3_axqsw")]

[node name="Cleave" parent="AttackManager" instance=ExtResource("6_eaq6t")]
knockbackForce = 50.0

[node name="StateMachine" parent="." node_paths=PackedStringArray("character", "initialState") instance=ExtResource("3_nbnit")]
character = NodePath("..")
initialState = NodePath("EnemyPursueState")

[node name="EnemyPursueState" parent="StateMachine" instance=ExtResource("4_0fxrs")]

[node name="Marker2D" type="Marker2D" parent="StateMachine/EnemyPursueState"]
position = Vector2(25, 0)

[node name="EnemyAttackState" parent="StateMachine" instance=ExtResource("5_b6vxn")]

[node name="EnemyDeathState" parent="StateMachine" instance=ExtResource("9_i6yqm")]

[node name="HurtState" parent="StateMachine" instance=ExtResource("7_pfd6a")]

[node name="HeadParticle" type="CPUParticles2D" parent="."]
texture_filter = 1
position = Vector2(0, -25)
emitting = false
amount = 1
lifetime = 2.0
one_shot = true
speed_scale = 0.75
texture = ExtResource("10_mkacl")
direction = Vector2(0, -1)
spread = 30.0
initial_velocity_min = 60.0
initial_velocity_max = 200.0
angular_velocity_min = -240.0
angular_velocity_max = 240.0
damping_max = 40.704

[connection signal="body_entered" from="AttackBox" to="." method="OnAttackBoxBodyEntered"]
